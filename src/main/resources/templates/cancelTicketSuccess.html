<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">
<head>
    <title>QuickTicket - 예매 취소 완료</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/myPage.css}">
</head>
<body>
<main layout:fragment="content">
    <div class="page-wrapper">
        <div class="main-container">
            <div class="cancel-success-wrap">
                <div class="success-header">
                    <h2 class="main-msg">예매 취소 완료</h2>
                    <p class="sub-msg">
                        고객님의 '<span id="eventName" style="font-weight:bold;"
                                    th:text="${ticket != null ? ticket.event?.name : ''}"></span>' 예매취소가 완료되었습니다.
                    </p>
                </div>

                <div class="info-section">
                    <h3 class="sub-title">공연 정보</h3>
                    <div class="gray-box info-box">
                        <div class="info-row">
                            <span class="label">공연명</span>
                            <span id="infoEventName" class="value"
                                  th:text="${ticket != null ? ticket.event?.name : ''}"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">공연일자</span>
                            <span id="infoPerformanceStartsAt" class="value"
                                  th:text="${ticket != null && ticket.performance != null ? #temporals.format(ticket.performance.performanceStartsAt, 'yyyy-MM-dd / a h:mm') : ''}"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">회차</span>
                            <span id="infoNth" class="value"
                                  th:text="${ticket != null && ticket.performance != null ? ticket.performance.nth + '회차' : ''}"></span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3 class="sub-title">예매 정보</h3>
                    <div class="gray-box info-box">
                        <div class="info-row">
                            <span class="label">예매번호</span>
                            <span id="infoTicketId" class="value"
                                  th:text="${ticket != null ? 'RES-' + ticket.id : ''}"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">취소 일시</span>
                            <span id="infoCanceledAt" class="value"
                                  th:text="${ticket != null && ticket.canceledAt != null ? #temporals.format(ticket.canceledAt, 'yyyy-MM-dd / HH:mm:ss') : ''}"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">취소 좌석</span>
                            <span id="infoCancelSummary" class="value"
                                  th:text="${ticket != null ? ticket.personNumber + '석 취소 완료' : ''}"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">좌석 상세</span>
                            <span id="infoSeatDetail" class="value">
                                    <th:block th:if="${ticket != null && ticket.seatPayments != null}">
                                        <th:block th:each="pay : ${ticket.seatPayments}">
                                            <span>
                                                좌석 정보 확인(ID:[[${pay.paidSeatId}]]) 1매
                                            </span><br>
                                        </th:block>
                                    </th:block>
                                </span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3 class="sub-title">환불 정보</h3>
                    <div class="gray-box info-box">
                        <div class="info-row">
                            <span class="label">결제수단</span>
                            <span id="paymentMethod" class="value"
                                  th:text="${ticket != null && ticket.paymentMethod?.methodDetails != null ? ticket.paymentMethod.methodDetails.bankName + ' (' + ticket.paymentMethod.methodDetails.cardNumber + ')' : ''}">
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="label">결제 상태</span>
                            <span id="paymentStatus" class="value">취소 완료</span>
                        </div>
                        <div class="info-row">
                            <span class="label">취소 수수료</span>
                            <span id="cancelFee" class="value">(-) 0원</span>
                        </div>
                        <div class="info-row">
                            <span class="label">최종 환불 예정 금액</span>
                            <span id="refundAmount" class="value highlight">0원</span>
                        </div>
                    </div>
                </div>

                <div class="footer-area">
                    <div class="btn-group">
                        <a th:href="@{/}" class="btn-list custom-btn">홈페이지</a>
                        <a th:href="@{/myPage/tickets}" class="btn-list custom-btn">예매내역 목록</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // 임시데이터
        const tempData = {
            eventName: "2026 이창섭 단독 콘서트 〈EndAnd〉 - 수원",
            startsAt: "2026-02-09 / 오후 05:00",
            nth: "1",
            ticketId: "1234567",
            canceledAt: "2026-01-20 / 14:30:22",
            personCount: "2",
            seats: [
                { name: "VIP석", count: 1 },
                { name: "R석", count: 1 }
            ],
            payMethod: "신용카드(Mock)",
            payStatus: "취소 완료",
            refundAmount: "240,000"
        };

        const setText = (id, val) => {
            const el = document.getElementById(id);

            if (el && (el.innerText.trim() === "" || el.innerText.trim() === "0원")) {
                el.innerText = val;
            }
        };

        setText("eventName", tempData.eventName);
        setText("infoEventName", tempData.eventName);
        setText("infoPerformanceStartsAt", tempData.startsAt);
        setText("infoNth", tempData.nth + "회차");
        setText("infoTicketId", "RES-2026-" + tempData.ticketId);
        setText("infoCanceledAt", tempData.canceledAt);
        setText("infoCancelSummary", tempData.personCount + "석 취소 완료");

        const payMethodText = "신한카드 (1234-****-****-5678)";
        setText("paymentMethod", payMethodText);

        setText("paymentStatus", tempData.payStatus);
        setText("cancelFee", "(-) 0원");
        setText("refundAmount", tempData.refundAmount + "원");

        const seatDetailBox = document.getElementById("infoSeatDetail");
        if (seatDetailBox) {
            seatDetailBox.innerHTML = "";
            tempData.seats.forEach(seat => {
                seatDetailBox.innerHTML += `<span>${seat.name} ${seat.count}매</span><br>`;
            });
        }

    </script>
</main>
</body>
</html>