<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/defaultLayout}">
<head>
    <title>QuickTicket - 예매 취소 완료</title>
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/myPage.css}">
</head>
<body>
    <main layout:fragment="content">
        <div class="page-wrapper">
            <div class="main-container">
                <div class="cancel-success-wrap">
                    <!-- 제목 영역 -->
                    <div class="success-header">
                        <h2 class="main-msg">예매 취소 완료</h2>
                        <p class="sub-msg">
                            고객님의 '<span id="eventName" style="font-weight:bold;">[[${event?.name}]]</span>' 예매취소가 완료되었습니다.
                        </p>
                    </div>
                    <!-- 공연정보 영역 -->
                    <div class="info-section">
                        <h3 class="sub-title">공연 정보</h3>
                        <div class="gray-box info-box">
                            <div class="info-row">
                                <span class="label">공연명</span>
                                <span id="infoEventName" class="value">[[${event?.name}]]</span>
                            </div>
                            <div class="info-row">
                                <span class="label">공연일자</span>
                                <span id="infoPerformanceStartsAt" class="value">
                                    [[${ticket?.performance?.performanceStartsAt != null ? #temporals.format(ticket.performance.performanceStartsAt, 'yyyy-MM-dd / a hh:mm') : ''}]]
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="label">회차</span>
                                <span id="infoNth" class="value">[[${ticket?.performance?.nth}]]회차</span>
                            </div>
                        </div>
                    </div>
                    <!-- 예매정보 영역 -->
                    <div class="info-section">
                        <h3 class="sub-title">예매 정보</h3>
                        <div class="gray-box info-box">
                            <div class="info-row">
                                <span class="label">예매번호</span>
                                <span id="infoTicketId" class="value">[[ 'RES-2026-' + ${ticket?.id} ]]</span>
                            </div>
                            <div class="info-row">
                                <span class="label">취소 일시</span>
                                <span id="infoCanceledAt" class="value">
                                    [[${canceledAt != null ? #temporals.format(canceledAt, 'yyyy-MM-dd / HH:mm:ss') : #temporals.format(#temporals.createNow(), 'yyyy-MM-dd / HH:mm:ss')}]]
                                </span>
                            </div>
                            <div class="info-row">
                                <span class="label">취소 좌석</span>
                                <span id="infoCancelSummary" class="value">[[${ticket?.personNumber}]]석 취소 완료</span>
                            </div>
                            <div class="info-row">
                                <span class="label">좌석 상세</span>
                                <span id="infoSeatDetail" class="value">
                                    <th:block th:each="seat : ${payment?.paidSeats}">
                                        <span>[[${seat?.name}]] [[${seat?.quantity}]]매</span><br>
                                    </th:block>
                                </span>
                            </div>
                        </div>
                    </div>
                    <!-- 환불정보 영역 -->
                    <div class="info-section">
                        <h3 class="sub-title">환불 정보</h3>
                        <div class="gray-box info-box">
                            <div class="info-row">
                                <span class="label">결제수단</span>
                                <span id="paymentMethod" class="value">[[${payment?.method}]]</span>
                            </div>
                            <div class="info-row">
                                <span class="label">결제 상태</span>
                                <span id="paymentStatus" class="value">[[${payment?.status}]]</span>
                            </div>
                            <div class="info-row">
                                <span class="label">취소 수수료</span>
                                <span id="cancelFee" class="value">(-) 0원</span>
                            </div>
                            <div class="info-row">
                                <span class="label">최종 환불 예정 금액</span>
                                <span id="refundAmount" class="value highlight">
                                    [[${payment?.amount != null ? #numbers.formatInteger(payment.amount, 0, 'COMMA') : 0}]]원
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="footer-area">
                        <p class="caution-note">※ 카드사 사정에 따라 환불까지 영업일 기준 3~5일이 소요될 수 있습니다.</p>

                        <div class="btn-group">
                            <a th:href="@{/}" class="btn-list custom-btn">홈페이지</a>
                            <a th:href="@{/myPage/tickets}" class="btn-list custom-btn">예매내역 목록</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            // 임시데이터 정의
            const tempData = {
                eventName: "2026 이창섭 단독 콘서트 〈EndAnd〉 - 수원",
                startsAt: "2026-02-09 / 오후 05:00",
                nth: "1",
                ticketId: "1234567",
                canceledAt: "2026-01-20 / 14:30:22",
                personCount: "2",
                seats: [
                    { name: "VIP석", count: 1 },
                    { name: "R석", count: 1 }
                ],
                payMethod: "신용카드",
                payStatus: "취소 완료",
                refundAmount: "240,000"
            };

            const setText = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.innerText = val;
            };

            setText("eventName", tempData.eventName);
            setText("infoEventName", tempData.eventName);
            setText("infoPerformanceStartsAt", tempData.startsAt);
            setText("infoNth", tempData.nth + "회차");
            setText("infoTicketId", "RES-2026-" + tempData.ticketId);
            setText("infoCanceledAt", tempData.canceledAt);
            setText("infoCancelSummary", tempData.personCount + "석 취소 완료");

            setText("paymentMethod", tempData.payMethod);
            setText("paymentStatus", tempData.payStatus);
            setText("cancelFee", "(-) 0원");
            setText("refundAmount", tempData.refundAmount + "원");

            // 좌석 리스트
            const seatDetailBox = document.getElementById("infoSeatDetail");
            if (seatDetailBox) {
                seatDetailBox.innerHTML = ""; // 초기화
                tempData.seats.forEach(seat => {
                    seatDetailBox.innerHTML += `<span>${seat.name} ${seat.count}매</span><br>`;
                });
            }
        </script>
    </main>
</body>
</html>